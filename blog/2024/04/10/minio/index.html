
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.com/blog/2024/04/10/minio/">
      
      
        <link rel="prev" href="../../03/traefik/">
      
      
        <link rel="next" href="../../28/proof-of-concept-opentelemetry-with-python-and-docker/">
      
      
      <link rel="icon" href="../../../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Minio - Kleber Yokota</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gentium+Plus:300,300i,400,400i,700,700i%7CExo+2:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Gentium Plus";--md-code-font:"Exo 2"}</style>
      
    
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#minio-longhorn-traefik-cert-manager-cloudflare-on-talos-kubernetes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Kleber Yokota" class="md-header__button md-logo" aria-label="Kleber Yokota" data-md-component="logo">
      
  <img src="../../../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Kleber Yokota
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Minio
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="amber"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../../" class="md-tabs__link">
          
  
  
    
  
  Blog

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Kleber Yokota" class="md-nav__button md-logo" aria-label="Kleber Yokota" data-md-component="logo">
      
  <img src="../../../../../assets/logo.png" alt="logo">

    </a>
    Kleber Yokota
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/datastack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datastack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/infrastructure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Infrastructure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/llm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    LLM
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/poc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    POC
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2024-04-10 00:00:00+00:00" class="md-ellipsis">Apr 10, 2024</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../../../category/infrastructure/">Infrastructure</a>, 
                              <a href="../../../../category/datastack/">Datastack</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              4 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#minio-longhorn-traefik-cert-manager-cloudflare-on-talos-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      MinIO + Longhorn + Traefik + Cert-Manager + Cloudflare on Talos Kubernetes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MinIO + Longhorn + Traefik + Cert-Manager + Cloudflare on Talos Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-minio" class="md-nav__link">
    <span class="md-ellipsis">
      What is MinIO?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-persist-data" class="md-nav__link">
    <span class="md-ellipsis">
      How to persist data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-longhorn" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Longhorn
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-longhorn-via-helm" class="md-nav__link">
    <span class="md-ellipsis">
      Installing Longhorn via Helm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-dns-tls-certificate-and-ingress-traefik-cert-manager-cloudflare" class="md-nav__link">
    <span class="md-ellipsis">
      Setting up DNS, TLS certificate, and Ingress (Traefik + cert-manager + Cloudflare)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setting up DNS, TLS certificate, and Ingress (Traefik + cert-manager + Cloudflare)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#certificate" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingressroute" class="md-nav__link">
    <span class="md-ellipsis">
      IngressRoute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installing-minio" class="md-nav__link">
    <span class="md-ellipsis">
      Installing MinIO
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Installing MinIO">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#certificate_1" class="md-nav__link">
    <span class="md-ellipsis">
      Certificate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingressroute_1" class="md-nav__link">
    <span class="md-ellipsis">
      IngressRoute
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bonus-tip-using-multiple-nvme-disks-with-longhorn" class="md-nav__link">
    <span class="md-ellipsis">
      Bonus tip: using multiple NVMe disks with Longhorn
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  


  <nav class="md-tags" >
    
      
      
      
        <span class="md-tag">datastack</span>
      
    
      
      
      
        <span class="md-tag">homelab</span>
      
    
      
      
      
        <span class="md-tag">k8s</span>
      
    
      
      
      
        <span class="md-tag">kubernetes</span>
      
    
      
      
      
        <span class="md-tag">longhorn</span>
      
    
      
      
      
        <span class="md-tag">minio</span>
      
    
      
      
      
        <span class="md-tag">tailscale</span>
      
    
      
      
      
        <span class="md-tag">talos</span>
      
    
  </nav>



  <h1>Minio</h1>

<h2 id="minio-longhorn-traefik-cert-manager-cloudflare-on-talos-kubernetes">MinIO + Longhorn + Traefik + Cert-Manager + Cloudflare on Talos Kubernetes</h2>
<h3 id="what-is-minio">What is MinIO?</h3>
<p>MinIO is an object storage system, just like AWS S3. In fact, it uses the same protocol. This means you can store any kind of file and access it via APIs or SDKs — a great foundation for your data stack.</p>
<p>It makes a lot of sense to have an object store in your infrastructure.</p>
<hr />
<!-- more -->
<h3 id="how-to-persist-data">How to persist data</h3>
<p>Kubernetes runs stateless containers — which means pods don’t keep any data. Every time a pod is restarted or scaled, it starts fresh.</p>
<p>But apps like MinIO or databases <strong>need</strong> to persist data. If you run a database pod without any volume, it will boot up empty every time.</p>
<p>To solve this, you create a <code>PersistentVolume</code> and a <code>PersistentVolumeClaim</code>. This way, your app knows where to store and recover data even after restarts.</p>
<p>In this setup, I’ll run everything on a single node, so I won’t worry about complex scheduling.</p>
<hr />
<h3 id="installing-longhorn">Installing Longhorn</h3>
<p>To manage storage, I’m using <strong>Longhorn</strong>, which automatically provisions volumes.</p>
<p>Longhorn needs special privileges, so let’s isolate it:</p>
<pre><code class="language-bash">kubectl create namespace longhorn-system
kubectl label namespace longhorn-system pod-security.kubernetes.io/enforce=privileged
</code></pre>
<p>Then, configure <strong>Talos OS</strong> to allow disk operations. This requires enabling two extensions and mounting a folder Longhorn uses.</p>
<p>Use <a href="https://factory.talos.dev/">Talos Factory</a> to build a custom image with these extensions:</p>
<ul>
<li><code>util-linux-tools</code></li>
<li><code>iscsi-tools</code></li>
</ul>
<pre><code class="language-bash">talos upgrade --image factory.talos.dev/installer/&lt;IMAGE_HASH&gt;:v1.9.4 -m powercycle -f -e 192.168.0.30 -n 192.168.0.30
</code></pre>
<blockquote>
<p>Warning: use only one IP for both <code>-e</code> and <code>-n</code>.</p>
</blockquote>
<p>Now update your <code>talosconfig</code>:</p>
<pre><code class="language-yaml">machine:
  kubelet:
    extraMounts:
      - destination: /var/lib/longhorn
        type: bind
        source: /var/lib/longhorn
        options:
          - bind
          - rshared
          - rw
</code></pre>
<p>Apply it:</p>
<pre><code class="language-bash">talosctl apply-config -f controlplane.yaml
</code></pre>
<hr />
<h3 id="installing-longhorn-via-helm">Installing Longhorn via Helm</h3>
<pre><code class="language-bash">helm repo add longhorn https://charts.longhorn.io
helm repo update
</code></pre>
<p>Create a <code>longhorn_values.yaml</code>:</p>
<pre><code class="language-yaml">defaultSettings:
  defaultReplicaCount: 1
persistence:
  reclaimPolicy: Retain
  defaultClassReplicaCount: 1
</code></pre>
<p>Then install:</p>
<pre><code class="language-bash">helm install longhorn longhorn/longhorn --namespace longhorn-system --create-namespace --version 1.8.1 -f longhorn_values.yaml
</code></pre>
<hr />
<h3 id="setting-up-dns-tls-certificate-and-ingress-traefik-cert-manager-cloudflare">Setting up DNS, TLS certificate, and Ingress (Traefik + cert-manager + Cloudflare)</h3>
<p>You’ll expose Longhorn with a domain like <code>longhorn.&lt;your-domain&gt;</code> pointing to your Traefik Load Balancer IP.</p>
<h4 id="certificate">Certificate</h4>
<pre><code class="language-yaml">apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: longhorn-certificate
  namespace: longhorn-system
spec:
  secretName: longhorn-certificate-prod
  issuerRef:
    name: cloudflare-issuer-prod
    kind: ClusterIssuer
  dnsNames:
    - longhorn.&lt;your-domain&gt;
</code></pre>
<blockquote>
<p>Wait for the certificate to be ready before applying the IngressRoute.</p>
</blockquote>
<h4 id="ingressroute">IngressRoute</h4>
<pre><code class="language-yaml">apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: longhorn-ingress
  namespace: longhorn-system
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`longhorn.&lt;your-domain&gt;`)
      kind: Rule
      services:
        - name: longhorn-frontend
          port: 80
  tls:
    secretName: longhorn-certificate-prod
</code></pre>
<hr />
<h3 id="installing-minio">Installing MinIO</h3>
<pre><code class="language-bash">helm repo add minio https://operator.min.io/
helm repo update
</code></pre>
<p>Create a <code>values.yaml</code> for the operator:</p>
<pre><code class="language-yaml">operator:
  env:
    - name: OPERATOR_STS_ENABLED
      value: &quot;on&quot;
  replicaCount: 1
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
      ephemeral-storage: 500Mi
</code></pre>
<p>Then install the operator:</p>
<pre><code class="language-bash">helm install minio minio-operator/operator -n minio -f values.yaml
</code></pre>
<p>Now install a <strong>tenant</strong>, which is the actual MinIO instance.</p>
<p>Create <code>tenant.yaml</code>:</p>
<pre><code class="language-yaml">tenant:
  name: myminio
  image:
    repository: quay.io/minio/minio
    tag: RELEASE.2025-03-12T18-04-18Z
    pullPolicy: IfNotPresent
  configSecret:
    name: myminio-env-configuration
    accessKey: minio
    secretKey: minio123
  pools:
    - servers: 1
      name: pool-0
      volumesPerServer: 1
      size: 300Gi
      storageClassName: longhorn
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
        fsGroupChangePolicy: &quot;OnRootMismatch&quot;
        runAsNonRoot: true
      containerSecurityContext:
        runAsUser: 1000
        runAsGroup: 1000
        runAsNonRoot: true
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        seccompProfile:
          type: RuntimeDefault
  mountPath: /export
  subPath: /data
  certificate:
    requestAutoCert: false
  exposeServices:
    console: false
    minio: false
</code></pre>
<blockquote>
<p>⚠️ Credentials are hardcoded for now. You should extract them into a Kubernetes Secret in production.</p>
</blockquote>
<pre><code class="language-bash">helm install --namespace tenant-ns --create-namespace tenant minio/tenant -f tenant.yaml
</code></pre>
<p>Note: MinIO tries to generate a self-signed cert which can break health checks. We’ll fix that using cert-manager.</p>
<h4 id="certificate_1">Certificate</h4>
<pre><code class="language-yaml">apiVersion: cert-manager.io/v1
kind: Certificate
metadata:
  name: minio-tenant-certificate
  namespace: tenant-ns
spec:
  secretName: minio-tenant-certificate-prod
  issuerRef:
    name: cloudflare-issuer-prod
    kind: ClusterIssuer
  dnsNames:
    - minio.&lt;your-domain&gt;
</code></pre>
<h4 id="ingressroute_1">IngressRoute</h4>
<pre><code class="language-yaml">apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: minio-tenant-ingress
  namespace: tenant-ns
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`minio.&lt;your-domain&gt;`)
      kind: Rule
      services:
        - name: myminio-console
          port: 9090
  tls:
    secretName: minio-tenant-certificate-prod
</code></pre>
<hr />
<h3 id="bonus-tip-using-multiple-nvme-disks-with-longhorn">Bonus tip: using multiple NVMe disks with Longhorn</h3>
<p>If you have multiple NVMe drives, you can configure Talos to use all of them with Longhorn.</p>
<p>List all available disks:</p>
<pre><code class="language-bash">talosctl get DiscoveredVolume
</code></pre>
<p>Then add this to your Talos config:</p>
<pre><code class="language-yaml">machine:
  disks:
    - device: /dev/nvme2n1
      partitions:
        - mountpoint: /var/lib/longhorn/nvme2n1/
    - device: /dev/nvme3n1
      partitions:
        - mountpoint: /var/lib/longhorn/nvme3n1/
</code></pre>
<p>Apply and reboot:</p>
<pre><code class="language-bash">talosctl apply-config -f controlplane.yaml
talosctl reboot
</code></pre>
<p>Now go to the Longhorn dashboard and add the new disks to each node.</p>
<hr />
<p>Enjoy your highly available object store setup with MinIO + Longhorn on Kubernetes!</p>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Kleber Yokota
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.sections", "navigation.path", "navigation.indexes", "toc.integrate"], "search": "../../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
    
  </body>
</html>